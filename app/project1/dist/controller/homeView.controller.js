sap.ui.define(["sap/ui/core/mvc/Controller","./../model/models","./../model/formatter","sap/m/MessageBox","sap/m/MessageToast"],(e,t,s,a,o)=>{"use strict";return e.extend("project1.controller.homeView",{formatter:s,onInit:async function(){const e=this.getView();const s=await new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});this.byId("itemTable").bindItems({path:"EntityList>/Employees",parameters:{$expand:"role,department"},template:new sap.m.ColumnListItem({type:"Active",press:this.onPressItem.bind(this),cells:[new sap.m.Text({text:"{EntityList>firstName},{EntityList>lastName}"}),new sap.m.Text({text:"{EntityList>role/name}"}),new sap.m.Text({text:"{EntityList>department/name}"}),new sap.m.Text({text:"{EntityList>email}"}),new sap.m.Button({id:"deleteButton",icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteEmployee.bind(this),tooltip:"{i18n>deleteTooltip}",enabled:{parts:["role>/role"],formatter:this.formatter.isAdmin}})]})});this.byId("itemLeaveTable").bindItems({path:"EntityList>/leaveRequest",parameters:{$expand:"employee"},template:new sap.m.ColumnListItem({id:"leaveListItem",type:"Active",cells:[new sap.m.Text({text:"{EntityList>employee/firstName} {EntityList>employee/lastName}"}),new sap.m.Text({text:"{EntityList>startDate}"}),new sap.m.Text({text:"{EntityList>endDate}"}),new sap.m.Text({text:"{EntityList>status}"}),new sap.m.Text({text:"{EntityList>reason}"}),new sap.m.Button({id:"deleteLeaveButton",icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteLeave.bind(this),enabled:{parts:["role>/role"],formatter:this.formatter.isAdmin}})]})});await e.setModel(s,"EntityList");const a=await t.getRole(e);console.log(a);await t.setVisibleControl(e)},onPressItem:async function(e){const s=this.getView();const a=e.getSource();const o=a.getBindingContext("EntityList");try{const e=await o.requestObject();const t=new sap.ui.model.json.JSONModel(e);console.log(t);this.getView().setModel(t,"employDetail")}catch(e){}s.getModel("VisibleControl").setProperty("/",{list:false,detail:true,create:false,listLeave:false,createLeave:false});t._setModel(s,{isEdit:false},"Edit")},onPressBack:function(){const e=this.getView();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false})},onPressLeave:function(){const e=this.getView();const t=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});e.getModel("VisibleControl").setProperty("/",{listLeave:true,createLeave:false,list:false,detail:false,create:false})},onPressEdit:function(){const e=this.getView();const t=e.getModel("Edit");const s=t.getProperty("/isEdit");t.setProperty("/isEdit",!s)},onPressCreList:function(){var e={statuses:[{key:"PENDING",text:"Pending"},{key:"APPROVED",text:"Approved"},{key:"REJECTED",text:"Rejected"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"statusModel");const s={status:"Pending",reason:"",endDate:"",startDate:"",employee:{ID:""}};const a=this.getView();a.setModel(new sap.ui.model.json.JSONModel(s),"createLeaveDetail");a.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:false,createLeave:true})},onPressCreEmp:function(){var e={Genders:[{key:"Male",text:"Male"},{key:"Female",text:"Female"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"genderModel");const s={firstName:"",lastName:"",email:"",hireDate:"",dateOfBirth:"",salary:0,gender:"",role:{ID:""},department:{ID:""}};const a=this.getView();a.setModel(new sap.ui.model.json.JSONModel(s),"createDetail");a.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:true,listLeave:false,createLeave:false})},onDeleteEmployee:function(e){const t=e.getSource().getParent();const s=t.getBindingContext("EntityList");if(!s){sap.m.MessageToast.show("No data found");return}sap.m.MessageBox.confirm("Are you sure to delete?",{onClose:async e=>{if(e===sap.m.MessageBox.Action.OK){try{if(typeof s.delete==="function"){await s.delete();sap.m.MessageToast.show("Delete success")}else{sap.m.MessageBox.error("Delete fail")}}catch(e){sap.m.MessageBox.error("Delete fail"+e.message)}}}})},onCreateEmployee:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("createDetail").getData();console.log(t);try{const a=t.bindList("/Employees");if(!s.firstName||!s.lastName){sap.m.MessageBox.warning("Please fill in first name.");return}if(!s.lastName||!s.lastName){sap.m.MessageBox.warning("Please fill in last name.");return}if(!s.email||!s.email){sap.m.MessageBox.warning("Please fill in email.");return}if(!s.hireDate||!s.hireDate){sap.m.MessageBox.warning("Please fill in hireDate.");return}await a.create(s);await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false});sap.m.MessageToast.show("Create success")}catch(e){console.log(e);sap.m.MessageBox.error("Create employee fail",e)}},onCreateLeave:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("createLeaveDetail").getData();console.log(t);try{const a=t.bindList("/leaveRequest");await a.create(s);sap.m.MessageToast.show("Create success");await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:true,createLeave:false})}catch(e){console.log(e);sap.m.MessageBox.error("Create leave request fail",e)}},onPressUpdate:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("employDetail").getData();try{const e=`/Employees(${s.ID})`;const a=t.bindContext(e);if(!a){sap.m.MessageBox.error("Not found data");return}const o=await a.getBoundContext();o.setProperty("firstName",s.firstName);o.setProperty("lastName",s.lastName);o.setProperty("email",s.email);o.setProperty("hireDate",s.hireDate);o.setProperty("salary",s.salary);o.setProperty("performanceRating",parseInt(s.performanceRating));o.setProperty("role_ID",s.role.ID);o.setProperty("department_ID",s.department.ID);sap.m.MessageToast.show("update employee success");await t.refresh()}catch(e){sap.m.MessageBox.error("Update employee fail",e)}},onPressSalary:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("employDetail");const a=e.getModel("employDetail").getData().ID;const o=e.getModel("employDetail").getData();try{const e=t.bindContext("/calEmpSalary(...)");await e.ready();const s=e.getParameterContext();console.log(o);await s.setProperty("Employee/ID",o.ID);await s.setProperty("Employee/hireDate",o.hireDate);await s.setProperty("Employee/role_ID",o.role.ID);await s.setProperty("Employee/performanceRating",parseInt(o.performanceRating,10));console.log("ofucntion",e);await e.execute();const a=await e.requestObject();console.log(a.value);if(a.value!==null&&a.value!==undefined&&!isNaN(a.value)){await t.refresh();this.getView().getModel("employDetail").setProperty("/salary",a.value);sap.m.MessageToast.show("Calculate salary success")}else{sap.m.MessageBox.error("Calculate salary fail")}}catch(e){console.error(e);sap.m.MessageBox.error("Call function fail: "+e.message)}},onDeleteLeave:function(e){const t=e.getSource().getParent();const s=t.getBindingContext("EntityList");if(!s){sap.m.MessageToast.show("No data found");return}sap.m.MessageBox.confirm("Are you sure to delete?",{onClose:async e=>{if(e===sap.m.MessageBox.Action.OK){try{if(typeof s.delete==="function"){await s.delete();sap.m.MessageToast.show("Delete success")}else{sap.m.MessageBox.error("Delete fail")}}catch(e){sap.m.MessageBox.error("Delete fail"+e.message)}}}})},onChangeText:function(e){const t=e.getSource();let s=t.getValue();var a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!s.match(a)){t.setValueState("Error");t.setValueStateText("Email not valid")}else{t.setValueState("Success");t.setValueStateText("Input email valid")}}})});
//# sourceMappingURL=homeView.controller.js.map