sap.ui.define(["sap/ui/core/mvc/Controller","./../model/models","./../model/formatter","sap/m/MessageBox","sap/m/MessageToast"],(e,t,s,a,o)=>{"use strict";return e.extend("project1.controller.homeView",{formatter:s,onInit:async function(){const e=this.getView();const s=await new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});console.log("call model");await e.setModel(s,"EntityList");await t.getRole(e);await t.setVisibleControl(e);this.byId("itemTable").bindItems({path:"EntityList>/Employees",parameters:{$expand:"role,department"},template:new sap.m.ColumnListItem({type:"Active",press:this.onPressItem.bind(this),cells:[new sap.m.Text({text:"{EntityList>firstName},{EntityList>lastName}"}),new sap.m.Text({text:"{EntityList>role/name}"}),new sap.m.Text({text:"{EntityList>department/name}"}),new sap.m.Text({text:"{EntityList>email}"}),new sap.m.Button({id:"deleteButton",icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteEmployee.bind(this),tooltip:"{i18n>deleteTooltip}",enabled:{parts:["role>/role"],formatter:this.formatter.isAdmin}})]})})},onPressItem:async function(e){const s=this.getView();const a=e.getSource();const o=a.getBindingContext("EntityList");try{const e=await o.requestObject();const t=new sap.ui.model.json.JSONModel(e);console.log(t);this.getView().setModel(t,"employDetail")}catch(e){}s.getModel("VisibleControl").setProperty("/",{list:false,detail:true,create:false,listLeave:false,createLeave:false});t._setModel(s,{isEdit:false},"Edit")},onPressBack:function(){const e=this.getView();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false})},onPressLeave:function(){const e=this.getView();const t=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/ojt/",synchronizationMode:"None"});e.getModel("VisibleControl").setProperty("/",{listLeave:true,createLeave:false,list:false,detail:false,create:false})},onPressEdit:function(){const e=this.getView();const t=e.getModel("Edit");const s=t.getProperty("/isEdit");t.setProperty("/isEdit",!s)},onPressCreList:function(){var e={statuses:[{key:"PENDING",text:"Pending"},{key:"APPROVED",text:"Approved"},{key:"REJECTED",text:"Rejected"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"statusModel");const s={status:"Pending",reason:"",endDate:"",startDate:"",employee:{ID:""}};const a=this.getView();a.setModel(new sap.ui.model.json.JSONModel(s),"createLeaveDetail");a.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:false,createLeave:true})},onPressCreEmp:function(){const e={firstName:"",lastName:"",email:"",hireDate:"",dateOfBirth:"",salary:0,gender:"",role:{ID:""},department:{ID:""}};const t=this.getView();t.setModel(new sap.ui.model.json.JSONModel(e),"createDetail");t.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:true,listLeave:false,createLeave:false})},onDeleteEmployee:function(e){const t=e.getSource().getParent();const s=t.getBindingContext("EntityList");if(!s){sap.m.MessageToast.show("No data found");return}sap.m.MessageBox.confirm("Are you sure to delete?",{onClose:async e=>{if(e===sap.m.MessageBox.Action.OK){try{if(typeof s.delete==="function"){await s.delete();sap.m.MessageToast.show("Delete success")}else{sap.m.MessageBox.error("Delete fail")}}catch(e){sap.m.MessageBox.error("Delete fail"+e.message)}}}})},onCreateEmployee:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("createDetail").getData();console.log(t);try{const a=t.bindList("/Employees");await a.create(s);sap.m.MessageToast.show("Create success");await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:true,detail:false,create:false,listLeave:false,createLeave:false})}catch(e){console.log(e);sap.m.MessageBox.error("Create employee fail",e)}},onCreateLeave:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("createLeaveDetail").getData();console.log(t);try{const a=t.bindList("/leaveRequest");await a.create(s);sap.m.MessageToast.show("Create success");await t.refresh();e.getModel("VisibleControl").setProperty("/",{list:false,detail:false,create:false,listLeave:true,createLeave:false})}catch(e){console.log(e);sap.m.MessageBox.error("Create leave request fail",e)}},onPressUpdate:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("employDetail").getData();try{const e=`/Employees(${s.ID})`;const a=t.bindContext(e);if(!a){sap.m.MessageBox.error("Not found data");return}const o=await a.getBoundContext();o.setProperty("firstName",s.firstName);o.setProperty("lastName",s.lastName);o.setProperty("email",s.email);o.setProperty("hireDate",s.hireDate);o.setProperty("performanceRating",parseInt(s.performanceRating));o.setProperty("role_ID",s.role.ID);o.setProperty("department_ID",s.department.ID);sap.m.MessageToast.show("update employee success");await t.refresh()}catch(e){sap.m.MessageBox.error("Update employee fail",e)}},onPressSalary:async function(){const e=this.getView();const t=e.getModel("EntityList");const s=e.getModel("employDetail");console.log(s);const a=e.getModel("employDetail").getData().ID;try{const s=t.bindContext("/calEmpSalary(...)");s.getParameterContext().setProperty("Employee/empID",a);await s.execute();const o=await s.requestObject();if(o.value===true){await t.refresh();const s=t.bindContext(`/Employees('${a}')`,null,{$expand:"role,department"});await s.getBoundContext();const o=await s.requestObject();const i=new sap.ui.model.json.JSONModel(o);e.setModel(i,"employDetail");sap.m.MessageToast.show("Update salary success")}else{sap.m.MessageBox.error("Update salary fail")}}catch(e){console.error(e);sap.m.MessageBox.error("Call function fail: "+e.message)}}})});
//# sourceMappingURL=homeView.controller.js.map